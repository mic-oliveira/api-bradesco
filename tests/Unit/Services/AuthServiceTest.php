<?php


namespace Tests\Unit\Services;


use BlastCloud\Guzzler\UsesGuzzler;
use Bradesco\Services\AuthService;
use GuzzleHttp\Psr7\Response;
use PHPUnit\Framework\TestCase;

class AuthServiceTest extends TestCase
{
    use UsesGuzzler;

    private AuthService $service;

    protected function setUp(): void
    {
        parent::setUp();
        $client = $this->guzzler->getClient(['base_uri' => "https://proxy.api.prebanco.com.br/"]);
        $this->service = new AuthService();
        $this->service->setClient($client);
    }

    public function testCreateToken()
    {
        $this->guzzler->expects($this->once())->post('/auth/server/v1.1/token')
            ->willRespond(
                new Response(201,[],
                '{
                            "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.ew0KICJ2ZXIiOiAiMS4wIiwNCiAiaXNzIjogImh0dHBzOi8vcHJveHkuYXBpLnByZWJhbmNvLmNvbS5ici9hdXRoL3NlcnZlci92MS4xL3Rva2VuIiwNCiAiYXVkIjogImh0dHBzOi8vcHJveHkuYXBpLnByZWJhbmNvLmNvbS5icjo4NDQzIiwNCiAiaWF0IjogMTYxMjQ2NTk1MSwNCiAiZXhwIjogMTYxMjU1MjMyNywNCiAic2NwIjogIkJvbGV0byIsDQogImp0aSI6ICJtb2NrU2Vzc2lvbi0xNDY2Njg2NDA3NjgxMTgwMzc4NTgyMDI0NTU2OTU3NTIyNDA1MjkiLA0KICJ0b2tlblR5cGUiOiAiYWNjZXNzIiwNCiAiY2xpZW50VHlwZSI6ICJzZXJ2ZXIiLA0KICJvd25lclR5cGUiIDogInNlcnZlciIsDQogImF1dGhEYXRhIjogImV5SjBlWEFpT2lKS1YxUWlMQ0pqZEhraU9pSktWMVFpTENKaGJHY2lPaUpTVTBFdFQwRkZVQ0lzSW1WdVl5STZJa0V5TlRaRFFrTXRTRk0xTVRJaWZRLmU1aFJCd1lKMGdGQlVqU21sSmdwb19nMnU3dk9EdzRmT1U0elZlMUE5aUVqaXhHMG5KMVBibHkzWGZTS3MtazJvNS1hNjVSSG9wTlVKcGlxejU1cUc3UWN0b1NiRU1ubkNyRDU3NldOUFhOMXJaNWFfVlpORTY3VlJoaVIxOE53bjNGZnBkRG0teTM1N05rS1hOVlRIWmJMV2l3eE10ZURxLXdIQmNQUXhlNHNXX2MxZl91OENVWU5HNXlteE5iNmIxWWdXS2hJQjNKeUtiU1pfZFdRWkpxX0pKTDdBNkx5YjBUWFlUcWhEVHVnYzNTRHZEYU9Cb0xoVW5OM2hCaVdlRnNCTEw1U3BHQnBRNzNJQzJrMTQ2TUpaTmVUOXJDcVRKMENaTGVFTHhsOW9US3N0dUZzU1VmWkZCbVRQU281c3EyZnVNQnZSQVRwb3BUcHRDYlFleWJORUpvVGNKLTgtRkdDeTNiSWw1M2ZFUHJLb3NCQ2xKa2YydXY5dVg3cFhKaXJEVWl5elU0UlhOWE1TQmRRVmtTTkNHUTF6SVAtYlFuNUptbjNQa0JfTFowbk1PZXdpYWVPOG9DYjBpd2I1YjhCejB4b2hIY0pfeXpNNHl2NW5adzJsUnhRakxpMGowM0ptamNlQkVtUDJNWWdoOEdDTm8wRTMyNzFyTXYyd3pnT215akExcVl0X045LVBGeGJjLW5zTVo3MDUzS3Z0UTJ5OThIUHBjYzZnNmFxYS04S2xUN2V4LUNGWDNnRUgyR2FhajNnYjVLUUFBTFQwTnI3WHBrRWo4cks5ZjBEY1hJSDlIRG1zR2ZweDF3bWFmRHYxZ3JBd3l6TTdYSU1YQzBDRXotTWdxOEduLW12YmloV0doS202NVRnR1lLZi1uTjlKZF9QeGdJLkcyQ1JHTDh0YzN6SERwUzNrbGZyTncuU0thaHlkOWRpeHV6QUh1QkVVRkdfdGJWTzhKU0k5ajM3SVdZU0NmU2ZITzJCcTFIeEJsNjhBNDJTOUtrbDZNYk00cHZkUXhqQnJSWVNWLUZ5Q3J4YWJVZlVwMWFqMmJTNDBwbmRZUFlYenNMYXlIemxlNWpfNmQxM1g5c3IxdHVzZXZrTDYzT0RwSGhHRW1WWFJBZWE2ckZoMDRnSDYtV2FtbXIwUGRaN2puaGxXUzdZVk4xRGdHYWlSbTJSUzcyVzdGSlpxOUpEY25Id1RSRF9ERGwtT0paWWNrZml3VVhpdC1vTkJCMDJxSEJIcVJpcGNXdUhQenR2ZC1EdG1Md1pXNDFpcWxDcm56YUExRjNOTV9rRXFqQk0zM2RRVWRIbGE4STJrVk05aEpkak9CaHd2bG13TWR0djFkWWRZV1RUWWtDN0I0bnFvQjFWbzA1OHJ2SzREMWdSSFU0NGVGTGEtY1F4QzE2bjJZU0MzS3BvajBQVkhhUVNadUVldWJXU3V0TEt6MHNTWmFLOVVJNi0tUGpkeVF2TkZ6YjBNNi11bksxUjRiY3VoT3VEOTN6LXNNTFp0anJIU1lXdmlSR2FGU3Vhc0I4SWVrMjFtUmVJaFlMaXprOU55SnppNGNXWGhkZHdhbUlZaEdUcmMwNTlheGtuN04xUWtROEZOU2FGWnFvbjRWUVhkbXhrNVgyTVhaRVhjRWpHbmx4aWZFZ29tYzdBeUgzUFN2NG5nOVhtMkM5akJUaVJ5TGlMMks3RTZTa3ZsS2dQcjRDaExlbjY3MlQ3SzNVOTJJY1lhai0yVUJoTlBST2EybnNDT2NqMkJFeGlvT1BRd0U1b25ENDVXZ2k2S1gyUkRmYlJzZmFvV213MjNvRWkxa2VnbXM0T012NF9KdER0b3ZKeGRjZEtDS3ZpQmJTaExpSmM0dl9vdWRsN2Y0NzYwYi1UcWRyWmpXZXdYbDdEdjJQQ29oNGluUVV0VFJ3Qy15ZmgybUo0OVVaLVNpQzRiOHBYcVhFSVljZUJJUVhIaHNoT0ZiUnY4N2xZekdmc3hIR1M4SGczcGZFdWtTakwtUXFZcWItazVPbnV2YTdjWjRnU3JfaUxRR3daQXE0YXRGREQtQnkwQmlOaDV0NEllLU8wTElUOVZlYnZ5WERLR2xFQmRsN3RzdGZRTGFGWVhhR0tQRllYQjIxcE5NYlhkT193cVpNWEtoTDlZa1N3S21HdjF0Y0JBZTk4aFdLWTY3YlM3bDAxLUtlSDFNdEdqaGNSQXZpSGFnbGRpQlY4SzVMLXd1Z1JxaHVtazltZ3M5MGx1TGlBLTBLUldOQkEyT19TUUZGMmQ0MTgxY0RXSWRxQzg5Q3BaTVI4TnhtQzdXTzNkSmJBMDFZUnhLNXRJdl96TEVOZlZGbExkRnJUTjBsZU5HTFBQZi15OHkwUElOTHdFZ3ZpTWpYdzdQUnA1Q19CRFJUZ0pSYmljQW5RdUoyOGhFdTFqci05VElxM3IzM1ZEeU11NDNSZWVlQlRlMnBxUS10VGRWUFk0U2lNTmdsOGd4QjlEWVF3S1M1cnhENUNObzVna1FDYjdhU0JGaUJZcW12MXRHUzlURDBOR21lRE9hWGtwU1d0RUx1anhkcGVQZVRabE1NVnRyeTRfVEtMQ2J6MDVyd1FpXzBNVUh2Y1VRT2lIaG1vRGhzTjVkT2J3ZHN2aUpya0k0YmpMQnBHeHF4aDc3c2k5TV9NNktxNnRvcWMzelI1RTlNSl95UFd2blR5MVNxbXkwU0ZxZGFwTm9mTTVJRm10ZWlxRGhxMm9lSTJSNzRLQlppOVRTRDRDUFF5bW01dmRjQ0FnVi1BQlFXNlJuS0taZm5hR2lieVd3c25taS1nT0hWSU82TUYxUDN5bVRpWi01T2Z1eE8wOW9LbHNBWDRiVXUzQ2M3UVBYWkxzVnM2Tl9DYl9MSTlDd18uSGtmeUlhYlRjdVVNY01FUzhkVlJzWmNwa1hTS1VRTXN6dUp6NzNMaHFuTSINCn0.N7y1NPiCOKzHubQFGvf-Aht7_X2y_7ZJ68oQFgFAWz_j1bt4UbYMOCRU5Z78Vz7cuoR6ctrMlegNgTxdX69GP97yUr64JvvcUxipHkWEYwnlhb8zs0S60s8b4Z6WipyOFpC-aI9_HkvboXtCZ0Ac2otpeFytMj2rlUqDQBEfiCq4Jg8P33iWcW2Ohy1imkDFAA3-5Swec1VF3CCyHGGaCOiVEQVigkDO4rsfDtucxGyKFyggNljh4EKbfE9lVEVqPV1pl5QtD7CRbB5yBs1D1EQBD_7hG0vrTWVmamI0Ws5nQplLlkTDNTp29R9N4OPG_dOpqiWMZBnhRcUOXJplc8CQtq5ffOlyHU9oRhXu_ue3cwUk-ZYkGmI-YcU6JGHnlNLrwJfwf6fgWVSKiPA3p9byqOv8uyK5CwjDs1DPn6g6eLyD5TTBEey9sR0KuDBCAYxeaX4vAxTpOAp-XUQvv2A9v8UHx1ApoS9IJsLfMipd6tJPvrt4FJYHptQbNlcvLx4_v7oHQVaBWuGK_4WGaGKGPSPfkpPF5A2sDGOyoOcbPi-LewD-7Yz8SvqdAOjkkQCKNOCkPzJ6fII5J--dxBSeVTRXJKqjVFa91nmjkqdnJlNCt9uXBwA04n7uYZ35KWj1qINDGt9kPBlVIcTCRlIy8-Grfbe7hsDraTdXc8Q",
                            "token_type": "Bearer",
                            "expires_in": 86375
                        }'
                )
            );
        $this->assertIsObject($this->service->accessToken(__DIR__.'/private.key.pem','1235'));

    }

}
